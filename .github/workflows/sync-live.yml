name: Sync Live from Scheduled-Updates

on:
  schedule:
    - cron: '*/5 * * * *'  # Every 5 minutes (UTC)
  workflow_dispatch:  # Manual trigger button

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout live branch
        uses: actions/checkout@v4
        with:
          ref: live
          token: ${{ secrets.PAT }}
          persist-credentials: true

      - name: Sync files from scheduled-updates
        run: |
          git remote add source https://rafafel:${{ secrets.PAT }}@github.com/rafafel/MJP.git || true
          git config core.sparse-checkout true
          echo "/*" > .git/info/sparse-checkout  # Sync entire repo contents
          git fetch source scheduled-updates
          git checkout source/scheduled-updates -- .
          git config core.sparse-checkout false

      - name: Commit and push
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          git add .
          git diff-index --quiet HEAD || git commit -m "Sync contents from scheduled-updates [$(date)]"
          git push origin live
